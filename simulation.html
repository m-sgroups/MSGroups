<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Simulation de prêt</title>
  <link rel="shortcut icon" href="logoMsg.png" type="image/x-icon">
  <link rel="stylesheet" href="css/styles.css">
  <link href="https://unpkg.com/aos@next/dist/aos.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
  <style>
    :root {
      --primary: #0a2540;
      --primary-light: #1a3a5f;
      --primary-dark: #051a30;
      --secondary: #c8a45c;
      --secondary-light: #d9bc7d;
      --secondary-dark: #b08d3e;
      --accent: #e6f0ff;
      --text: #333333;
      --text-light: #666666;
      --light: #f8f9fa;
      --white: #ffffff;
      --dark: #1a1a1a;
      --shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
      --shadow-strong: 0 15px 35px rgba(0, 0, 0, 0.12);
      --radius: 12px;
      --radius-sm: 6px;
      --transition: all 0.4s cubic-bezier(0.165, 0.84, 0.44, 1);
    }

    * { 
      box-sizing: border-box; 
      margin: 0; 
      padding: 0;
    }

    body {
      font-family: 'Montserrat', sans-serif;
      margin: 0;
      padding: 0;
      background: var(--light);
      color: var(--text);
      line-height: 1.7;
      overflow-x: hidden;
    }

    h1, h2, h3, h4, h5 {
      font-family: 'Playfair Display', serif;
      font-weight: 600;
      line-height: 1.3;
    }

    .container {
      max-width: 1300px;
      margin: 0 auto;
      padding: 0 30px;
      position: relative;
      z-index: 1;
    }

    /* Header & Navigation */
    header {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      z-index: 1000;
      transition: var(--transition);
      padding: 20px 0;
      background: rgba(10, 37, 64, 0.95);
      backdrop-filter: blur(10px);
      box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
    }

    .header-container {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .logo {
      display: flex;
      align-items: center;
      text-decoration: none;
    }

    .logo-circle {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      margin-right: 15px;
      transition: var(--transition);
      background-color: var(--primary);
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--secondary);
      font-weight: bold;
      box-shadow: 0 0 15px rgba(200, 164, 92, 0.3);
    }

    .logo-text {
      color: var(--white);
      font-family: 'Playfair Display', serif;
      font-size: 1.5rem;
      font-weight: 600;
      transition: var(--transition);
    }

    nav ul {
      display: flex;
      list-style: none;
      gap: 2rem;
    }

    nav a {
      color: var(--white);
      text-decoration: none;
      font-size: 0.95rem;
      font-weight: 500;
      letter-spacing: 0.5px;
      text-transform: uppercase;
      padding: 8px 0;
      position: relative;
      transition: var(--transition);
    }

    nav a::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      width: 0;
      height: 2px;
      background: var(--secondary);
      transition: var(--transition);
    }

    nav a:hover {
      color: var(--secondary);
    }

    nav a:hover::after {
      width: 100%;
    }

    .nav-cta {
      background: var(--secondary);
      color: var(--primary-dark) !important;
      padding: 10px 20px !important;
      border-radius: 30px;
      font-weight: 600;
      box-shadow: 0 5px 15px rgba(200, 164, 92, 0.3);
      transition: var(--transition);
    }

    .nav-cta:hover {
      background: var(--secondary-light);
      transform: translateY(-3px);
      box-shadow: 0 8px 20px rgba(200, 164, 92, 0.4);
    }

    .nav-cta::after {
      display: none;
    }

    .menu-toggle {
      display: none;
      background: none;
      border: none;
      color: var(--white);
      font-size: 1.5rem;
      cursor: pointer;
      z-index: 1001;
    }

    /* Page Header */
    .page-header {
      background: linear-gradient(135deg, var(--primary-dark), var(--primary));
      color: var(--white);
      padding: 150px 0 80px;
      text-align: center;
      position: relative;
      overflow: hidden;
    }

    .page-header::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-image: url('https://images.unsplash.com/photo-1560520653-9e0e4c89eb11?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=2073&q=80');
      background-size: cover;
      background-position: center;
      opacity: 0.1;
      z-index: 0;
    }

    .page-header .container {
      position: relative;
      z-index: 1;
    }

    .page-title {
      font-size: 3.5rem;
      margin-bottom: 1rem;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
    }

    .page-subtitle {
      font-size: 1.2rem;
      max-width: 700px;
      margin: 0 auto;
      opacity: 0.9;
    }

    /* Simulation Section */
    .simulation-section {
      padding: 80px 0;
    }

    .simulation-container {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 40px;
      margin-top: 40px;
    }

    .simulation-form {
      background: var(--white);
      padding: 40px;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
    }

    .simulation-form h3 {
      color: var(--primary);
      margin-bottom: 30px;
      font-size: 1.8rem;
      position: relative;
      padding-bottom: 15px;
    }

    .simulation-form h3::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      width: 60px;
      height: 3px;
      background: var(--secondary);
    }

    .form-group {
      margin-bottom: 25px;
    }

    .form-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: var(--primary);
    }

    .form-group input[type="number"],
    .form-group input[type="range"],
    .form-group select {
      width: 100%;
      padding: 12px 15px;
      border: 1px solid rgba(0, 0, 0, 0.1);
      border-radius: var(--radius-sm);
      font-size: 1rem;
      font-family: 'Montserrat', sans-serif;
      transition: var(--transition);
    }

    .form-group input:focus,
    .form-group select:focus {
      outline: none;
      border-color: var(--secondary);
      box-shadow: 0 0 0 3px rgba(200, 164, 92, 0.1);
    }

    .range-container {
      position: relative;
      padding-bottom: 20px;
    }

    .range-input {
      width: 100%;
      -webkit-appearance: none;
      height: 8px;
      border-radius: 5px;
      background: #ddd;
      outline: none;
      margin-top: 10px;
    }

    .range-input::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: var(--secondary);
      cursor: pointer;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
    }

    .range-input::-moz-range-thumb {
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: var(--secondary);
      cursor: pointer;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
      border: none;
    }

    .range-labels {
      display: flex;
      justify-content: space-between;
      font-size: 0.8rem;
      color: var(--text-light);
      margin-top: 5px;
    }

    .range-value {
      position: absolute;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      font-size: 0.9rem;
      font-weight: 600;
      color: var(--primary);
    }

    .btn-calculate {
      display: block;
      width: 100%;
      padding: 15px;
      background: var(--secondary);
      color: var(--primary-dark);
      border: none;
      border-radius: 50px;
      font-size: 1.1rem;
      font-weight: 700;
      cursor: pointer;
      transition: var(--transition);
      margin-top: 20px;
      box-shadow: 0 5px 15px rgba(200, 164, 92, 0.3);
    }

    .btn-calculate:hover {
      background: var(--secondary-light);
      transform: translateY(-3px);
      box-shadow: 0 8px 25px rgba(200, 164, 92, 0.4);
    }

    .simulation-result {
      background: var(--white);
      padding: 40px;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      position: relative;
    }

    .simulation-result h3 {
      color: var(--primary);
      margin-bottom: 30px;
      font-size: 1.8rem;
      position: relative;
      padding-bottom: 15px;
    }

    .simulation-result h3::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      width: 60px;
      height: 3px;
      background: var(--secondary);
    }

    .result-content {
      margin-bottom: 30px;
    }

    .result-item {
      display: flex;
      justify-content: space-between;
      padding: 15px 0;
      border-bottom: 1px solid rgba(0, 0, 0, 0.1);
    }

    .result-item:last-child {
      border-bottom: none;
    }

    .result-label {
      font-weight: 600;
      color: var(--primary);
    }

    .result-value {
      font-weight: 700;
      color: var(--secondary-dark);
      font-size: 1.1rem;
    }

    .monthly-payment {
      background: var(--accent);
      padding: 20px;
      border-radius: var(--radius);
      text-align: center;
      margin-bottom: 30px;
    }

    .monthly-payment-label {
      font-size: 1.1rem;
      color: var(--primary);
      margin-bottom: 10px;
    }

    .monthly-payment-value {
      font-size: 2.5rem;
      font-weight: 700;
      color: var(--primary);
      font-family: 'Playfair Display', serif;
    }

    .amortization-table {
      margin-top: 30px;
      overflow: auto;
      max-height: 300px;
      border-radius: var(--radius-sm);
      border: 1px solid rgba(0, 0, 0, 0.1);
    }

    .amortization-table table {
      width: 100%;
      border-collapse: collapse;
    }

    .amortization-table th {
      background: var(--primary);
      color: var(--white);
      padding: 12px 15px;
      text-align: left;
      position: sticky;
      top: 0;
    }

    .amortization-table td {
      padding: 12px 15px;
      border-bottom: 1px solid rgba(0, 0, 0, 0.1);
    }

    .amortization-table tr:nth-child(even) {
      background: rgba(230, 240, 255, 0.3);
    }

    .amortization-table tr:hover {
      background: rgba(200, 164, 92, 0.1);
    }

    .btn-download {
      display: block;
      width: 100%;
      padding: 15px;
      background: var(--primary);
      color: var(--white);
      border: none;
      border-radius: 50px;
      font-size: 1.1rem;
      font-weight: 700;
      cursor: pointer;
      transition: var(--transition);
      margin-top: 30px;
      box-shadow: 0 5px 15px rgba(10, 37, 64, 0.3);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }

    .btn-download i {
      font-size: 1.2rem;
    }

    .btn-download:hover {
      background: var(--primary-light);
      transform: translateY(-3px);
      box-shadow: 0 8px 25px rgba(10, 37, 64, 0.4);
    }

    .no-result {
      text-align: center;
      padding: 50px 0;
      color: var(--text-light);
    }

    .no-result i {
      font-size: 3rem;
      color: var(--primary-light);
      margin-bottom: 20px;
      opacity: 0.5;
    }

    .no-result p {
      font-size: 1.1rem;
    }

    /* Footer */
    footer {
      background: var(--primary-dark);
      color: rgba(255, 255, 255, 0.7);
      padding: 80px 0 30px;
      position: relative;
      overflow: hidden;
    }

    footer::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 5px;
      background: linear-gradient(to right, var(--primary), var(--secondary), var(--primary));
    }

    .footer-content {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 50px;
      margin-bottom: 50px;
    }

    .footer-column h4 {
      color: var(--white);
      font-size: 1.3rem;
      margin-bottom: 25px;
      position: relative;
      padding-bottom: 15px;
    }

    .footer-column h4::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      width: 40px;
      height: 2px;
      background: var(--secondary);
    }

    .footer-about .logo-circle {
      width: 80px;
      height: 80px;
      font-size: 1.5rem;
      margin-bottom: 20px;
    }

    .footer-about p {
      margin-bottom: 20px;
      line-height: 1.7;
    }

    .footer-links ul {
      list-style: none;
    }

    .footer-links li {
      margin-bottom: 12px;
    }

    .footer-links a {
      color: rgba(255, 255, 255, 0.7);
      text-decoration: none;
      transition: var(--transition);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .footer-links a:hover {
      color: var(--secondary);
      transform: translateX(5px);
    }

    .footer-links a i {
      font-size: 0.8rem;
    }

    .footer-contact p {
      margin-bottom: 15px;
      display: flex;
      align-items: flex-start;
      gap: 15px;
    }

    .footer-contact i {
      color: var(--secondary);
      font-size: 1.2rem;
      margin-top: 3px;
    }

    .footer-newsletter p {
      margin-bottom: 20px;
    }

    .newsletter-form {
      display: flex;
      gap: 10px;
    }

    .newsletter-input {
      flex: 1;
      padding: 12px 15px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      background: rgba(255, 255, 255, 0.05);
      border-radius: var(--radius-sm);
      color: var(--white);
      font-size: 0.9rem;
    }

    .newsletter-input:focus {
      outline: none;
      border-color: var(--secondary);
    }

    .newsletter-button {
      background: var(--secondary);
      color: var(--primary-dark);
      border: none;
      padding: 12px 15px;
      border-radius: var(--radius-sm);
      cursor: pointer;
      transition: var(--transition);
    }

    .newsletter-button:hover {
      background: var(--secondary-light);
      transform: translateY(-3px);
    }

    .footer-social {
      display: flex;
      gap: 15px;
      margin-top: 20px;
    }

    .social-icon {
      width: 40px;
      height: 40px;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--white);
      font-size: 1.1rem;
      transition: var(--transition);
    }

    .social-icon:hover {
      background: var(--secondary);
      color: var(--primary-dark);
      transform: translateY(-5px);
    }

    .footer-bottom {
      text-align: center;
      padding-top: 30px;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
      font-size: 0.9rem;
    }

    .footer-bottom a {
      color: var(--secondary);
      text-decoration: none;
    }

    /* Back to Top Button */
    .back-to-top {
      position: fixed;
      bottom: 30px;
      right: 30px;
      width: 50px;
      height: 50px;
      background: var(--secondary);
      color: var(--primary-dark);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.2rem;
      cursor: pointer;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      transition: var(--transition);
      opacity: 0;
      visibility: hidden;
      z-index: 999;
    }

    .back-to-top.active {
      opacity: 1;
      visibility: visible;
    }

    .back-to-top:hover {
      background: var(--secondary-light);
      transform: translateY(-5px);
    }

    /* PDF Preview Modal */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      z-index: 1100;
      overflow: auto;
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .modal.active {
      display: block;
      opacity: 1;
    }

    .modal-content {
      background: var(--white);
      margin: 50px auto;
      padding: 30px;
      width: 80%;
      max-width: 800px;
      border-radius: var(--radius);
      box-shadow: var(--shadow-strong);
      position: relative;
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 1px solid rgba(0, 0, 0, 0.1);
    }

    .modal-title {
      font-size: 1.8rem;
      color: var(--primary);
    }

    .modal-close {
      font-size: 1.5rem;
      color: var(--text-light);
      background: none;
      border: none;
      cursor: pointer;
      transition: var(--transition);
    }

    .modal-close:hover {
      color: var(--primary);
      transform: scale(1.1);
    }

    .pdf-preview {
      background: var(--light);
      padding: 30px;
      border-radius: var(--radius);
      margin-bottom: 30px;
    }

    .pdf-header {
      text-align: center;
      margin-bottom: 30px;
    }

    .pdf-logo {
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 20px;
    }

    .pdf-logo-circle {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: var(--primary);
      color: var(--secondary);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: 1.2rem;
      margin-right: 15px;
    }

    .pdf-logo-text {
      font-family: 'Playfair Display', serif;
      font-size: 1.8rem;
      font-weight: 600;
      color: var(--primary);
    }

    .pdf-title {
      font-size: 2rem;
      color: var(--primary);
      margin-bottom: 10px;
    }

    .pdf-subtitle {
      font-size: 1.1rem;
      color: var(--text-light);
    }

    .pdf-date {
      font-size: 0.9rem;
      color: var(--text-light);
      margin-top: 10px;
    }

    .pdf-section {
      margin-bottom: 30px;
    }

    .pdf-section-title {
      font-size: 1.5rem;
      color: var(--primary);
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 2px solid var(--secondary);
    }

    .pdf-loan-details {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 20px;
      margin-bottom: 30px;
    }

    .pdf-detail-item {
      background: var(--white);
      padding: 15px;
      border-radius: var(--radius-sm);
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
    }

    .pdf-detail-label {
      font-size: 0.9rem;
      color: var(--text-light);
      margin-bottom: 5px;
    }

    .pdf-detail-value {
      font-size: 1.3rem;
      font-weight: 700;
      color: var(--primary);
    }

    .pdf-monthly-payment {
      background: var(--accent);
      padding: 20px;
      border-radius: var(--radius);
      text-align: center;
      margin-bottom: 30px;
    }

    .pdf-monthly-label {
      font-size: 1.1rem;
      color: var(--primary);
      margin-bottom: 10px;
    }

    .pdf-monthly-value {
      font-size: 2.5rem;
      font-weight: 700;
      color: var(--primary);
      font-family: 'Playfair Display', serif;
    }

    .pdf-table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 30px;
    }

    .pdf-table th {
      background: var(--primary);
      color: var(--white);
      padding: 12px 15px;
      text-align: left;
    }

    .pdf-table td {
      padding: 12px 15px;
      border-bottom: 1px solid rgba(0, 0, 0, 0.1);
    }

    .pdf-table tr:nth-child(even) {
      background: rgba(230, 240, 255, 0.3);
    }

    .pdf-footer {
      text-align: center;
      margin-top: 50px;
      padding-top: 20px;
      border-top: 1px solid rgba(0, 0, 0, 0.1);
      font-size: 0.9rem;
      color: var(--text-light);
    }

    .pdf-footer p {
      margin-bottom: 5px;
    }

    .pdf-contact {
      margin-top: 15px;
      font-weight: 600;
      color: var(--primary);
    }

    .modal-actions {
      display: flex;
      justify-content: center;
      gap: 20px;
    }

    .btn-download-pdf {
      padding: 12px 25px;
      background: var(--secondary);
      color: var(--primary-dark);
      border: none;
      border-radius: 50px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: var(--transition);
      display: flex;
      align-items: center;
      gap: 10px;
      box-shadow: 0 5px 15px rgba(200, 164, 92, 0.3);
    }

    .btn-download-pdf:hover {
      background: var(--secondary-light);
      transform: translateY(-3px);
      box-shadow: 0 8px 25px rgba(200, 164, 92, 0.4);
    }

    .btn-close-modal {
      padding: 12px 25px;
      background: var(--light);
      color: var(--text);
      border: 1px solid rgba(0, 0, 0, 0.1);
      border-radius: 50px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: var(--transition);
    }

    .btn-close-modal:hover {
      background: var(--white);
      transform: translateY(-3px);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    }

    /* Responsive Design */
    @media (max-width: 1200px) {
      .footer-content {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    @media (max-width: 992px) {
      .simulation-container {
        grid-template-columns: 1fr;
      }
      
      .pdf-loan-details {
        grid-template-columns: 1fr;
      }
    }

    @media (max-width: 768px) {
      .page-title {
        font-size: 2.5rem;
      }
      
      .page-subtitle {
        font-size: 1.1rem;
      }
      
      nav ul {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100vh;
        background: rgba(10, 37, 64, 0.95);
        flex-direction: column;
        justify-content: center;
        align-items: center;
        gap: 2rem;
        z-index: 1000;
        transition: var(--transition);
      }
      
      nav ul.active {
        display: flex;
      }
      
      nav a {
        font-size: 1.2rem;
      }
      
      .menu-toggle {
        display: block;
      }
      
      .footer-content {
        grid-template-columns: 1fr;
        gap: 40px;
      }
      
      .modal-content {
        width: 95%;
        padding: 20px;
      }
    }

    @media (max-width: 576px) {
      .container {
        padding: 0 20px;
      }
      
      .page-title {
        font-size: 2rem;
      }
      
      .simulation-form,
      .simulation-result {
        padding: 30px 20px;
      }
      
      .simulation-form h3,
      .simulation-result h3 {
        font-size: 1.5rem;
      }
      
      .monthly-payment-value {
        font-size: 2rem;
      }
      
      .modal-actions {
        flex-direction: column;
      }
      
      .btn-download-pdf,
      .btn-close-modal {
        width: 100%;
      }
    }
    
    /* Styles pour le sélecteur de langue */
    .language-selector-container {
      position: relative;
      margin-left: 20px;
    }
    
    .language-selector {
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      color: var(--white);
      padding: 8px 30px 8px 12px;
      border-radius: 20px;
      font-size: 0.9rem;
      cursor: pointer;
      appearance: none;
      -webkit-appearance: none;
      -moz-appearance: none;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%23ffffff' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 10px center;
      background-size: 12px;
      transition: var(--transition);
    }
    
    .language-selector:hover {
      background-color: rgba(255, 255, 255, 0.2);
    }
    
    .language-selector:focus {
      outline: none;
      box-shadow: 0 0 0 2px var(--secondary);
    }
    
    .language-selector option {
      background-color: var(--primary);
      color: var(--white);
    }
    
    @media (max-width: 768px) {
      .language-selector-container {
        position: absolute;
        top: 20px;
        right: 70px;
      }
    }
  </style>
</head>
<body>
  <body>
  <header>
    <div class="container header-container">
      <a href="index_langue.html" class="logo i18n-link">
        <div class="logo-circle">MSG</div>
        <div class="logo-text">Magdeleine Solutions</div>
      </a>
      <nav>
        <div class="menu-toggle" id="menu-toggle">
          <i class="fas fa-bars"></i>
        </div>
        <ul class="nav-menu" id="nav-menu">
          <li><a href="index.html" class="i18n-link" data-i18n="nav_home">Accueil</a></li>
          <li><a href="index.html#about" class="i18n-link" data-i18n="nav_about">À propos</a></li>
          <li><a href="index.html#testimonials" class="i18n-link" data-i18n="nav_testimonials">Témoignages</a></li>
          <li><a href="biographie.html" class="i18n-link" data-i18n="nav_biography">Biographie</a></li>
          <li><a href="simulation.html" class="i18n-link" data-i18n="nav_simulation">Simulation</a></li>
          <li><a href="formulaire_demande.html" class="i18n-link nav-cta" data-i18n="nav_loan_request">Demande de prêt</a></li>
        </ul>
        <div class="language-selector-container">
          <select id="language-selector" class="language-selector" aria-label="Changer de langue">
            <option value="fr" data-i18n="lang_fr">Français</option>
            <option value="en" data-i18n="lang_en">Anglais</option>
            <option value="pl" data-i18n="lang_pl">Polonais</option>
            <option value="de" data-i18n="lang_de">Allemand</option>
            <option value="it" data-i18n="lang_it">Italien</option>
            <option value="pt" data-i18n="lang_pt">Portugais</option>
          </select>
        </div>
      </nav>
    </div>
  </header>
  
  <!-- Page Header -->
  <div class="page-header">
    <div class="container">
      <h1 class="page-title" data-aos="fade-up" data-i18n="sim_title">Simulation de prêt</h1>
      <p class="page-subtitle" data-aos="fade-up" data-aos-delay="200" data-i18n="sim_subtitle">Calculez vos mensualités et obtenez un aperçu détaillé de votre prêt</p>
    </div>
  </div>

  <section class="simulation-section">
    <div class="container">
      <div class="simulation-container">
        <div class="simulation-form">
          <h3 data-i18n="sim_form_title">Paramètres du prêt</h3>
          <div class="form-group">
            <label for="loanAmountRange" data-i18n="sim_amount_borrowed">Montant du Prêt</label>
            <div class="range-container">
              <input type="range" id="loanAmountRange" class="range-input" min="2000" max="1000000" value="100000">
              <div class="range-labels">
                <span>2 000 €</span>
                <span>1 000 000 €</span>
              </div>
              <div class="range-value" id="loanAmountValue">100 000,00 €</div>
            </div>
            <input type="number" id="loanAmount" min="2000" max="1000000" value="100000">
          </div>
          
          <div class="form-group">
            <label for="loanDurationRange" data-i18n="sim_duration">Durée du prêt</label>
            <div class="range-container">
              <input type="range" id="loanDurationRange" class="range-input" min="12" max="360" value="120">
              <div class="range-labels">
                <span>1 an</span>
                <span>30 ans</span>
              </div>
              <div class="range-value" id="loanDurationValue">120 mois (10 ans)</div>
            </div>
            <select id="loanDuration">
              <option value="12" data-i18n="duration_12">12 mois</option>
              <option value="24" data-i18n="duration_24">24 mois</option>
              <option value="36" data-i18n="duration_36">36 mois</option>
              <option value="48" data-i18n="duration_48">48 mois</option>
              <option value="60" data-i18n="duration_60">60 mois</option>
              <option value="72" data-i18n="duration_72">72 mois</option>
              <option value="84" data-i18n="duration_84">84 mois</option>
              <option value="96" data-i18n="duration_96">96 mois</option>
              <option value="108" data-i18n="duration_108">108 mois</option>
              <option value="120" selected data-i18n="duration_120">120 mois</option>
              <option value="132" data-i18n="duration_132">132 mois</option>
              <option value="144" data-i18n="duration_144">144 mois</option>
              <option value="156" data-i18n="duration_156">156 mois</option>
              <option value="168" data-i18n="duration_168">168 mois</option>
              <option value="180" data-i18n="duration_180">180 mois</option>
              <option value="192" data-i18n="duration_192">192 mois</option>
              <option value="204" data-i18n="duration_204">204 mois</option>
              <option value="216" data-i18n="duration_216">216 mois</option>
              <option value="228" data-i18n="duration_228">228 mois</option>
              <option value="240" data-i18n="duration_240">240 mois</option>
              <option value="252" data-i18n="duration_252">252 mois</option>
              <option value="264" data-i18n="duration_264">264 mois</option>
              <option value="276" data-i18n="duration_276">276 mois</option>
              <option value="288" data-i18n="duration_288">288 mois</option>
              <option value="300" data-i18n="duration_300">300 mois</option>
              <option value="312" data-i18n="duration_312">312 mois</option>
              <option value="324" data-i18n="duration_324">324 mois</option>
              <option value="336" data-i18n="duration_336">336 mois</option>
              <option value="348" data-i18n="duration_348">348 mois</option>
              <option value="360" data-i18n="duration_360">360 mois</option>
            </select>
          </div>
          
          <div class="form-group">
            <label for="interestRateRange" data-i18n="sim_rate">Taux d'intérêt</label>
            <div class="range-container">
              <input type="range" id="interestRateRange" class="range-input" min="1" max="10" step="0.1" value="3">
              <div class="range-labels">
                <span>1%</span>
                <span>10%</span>
              </div>
              <div class="range-value" id="interestRateValue">3,0%</div>
            </div>
            <input type="number" id="interestRate" min="1" max="10" step="0.1" value="3">
          </div>
          
          <div class="form-group">
            <label for="loanType" data-i18n="sim_type">Type de prêt</label>
            <select id="loanType">
              <option value="personal" data-i18n="loan_type_personal">Prêt personnel</option>
              <option value="mortgage" data-i18n="loan_type_mortgage">Prêt immobilier</option>
              <option value="business" data-i18n="loan_type_business">Prêt professionnel</option>
              <option value="debt_consolidation" data-i18n="loan_type_debt_consolidation">Rachat de crédit</option>
            </select>
          </div>
          
          <button type="button" id="calculateBtn" class="btn-calculate" data-i18n="sim_calculate">
            <i class="fas fa-calculator"></i> Calculer
          </button>
        </div>
        
        <div class="simulation-result" style="display: none;">
          <h3 data-i18n="sim_results_title">Résultats de la simulation</h3>
          
          <div class="monthly-payment">
            <div class="monthly-payment-label" data-i18n="sim_monthly">Mensualité</div>
            <div class="monthly-payment-value" id="monthlyPaymentValue">965,61 €</div>
          </div>
          
          <div class="result-content">
            <div class="result-item">
              <div class="result-label" data-i18n="sim_amount_borrowed">Montant emprunté</div>
              <div class="result-value" id="loanAmountResult">100 000,00 €</div>
            </div>
            <div class="result-item">
              <div class="result-label" data-i18n="sim_duration">Durée du prêt</div>
              <div class="result-value" id="loanDurationResult">120 mois (10 ans)</div>
            </div>
            <div class="result-item">
              <div class="result-label" data-i18n="sim_rate">Taux d'intérêt</div>
              <div class="result-value" id="interestRateResult">3,0%</div>
            </div>
            <div class="result-item">
              <div class="result-label" data-i18n="sim_total_interest">Coût total des intérêts</div>
              <div class="result-value" id="totalInterestResult">15 873,59 €</div>
            </div>
            <div class="result-item">
              <div class="result-label" data-i18n="sim_total_cost">Coût total du crédit</div>
              <div class="result-value" id="totalCostResult">115 873,59 €</div>
            </div>
          </div>
          
          <div class="amortization-table">
            <table>
              <thead>
                <tr>
                  <th data-i18n="sim_table_year">Année</th>
                  <th data-i18n="sim_table_principal">Capital remboursé</th>
                  <th data-i18n="sim_table_interest">Intérêts payés</th>
                  <th data-i18n="sim_table_remaining">Capital restant</th>
                </tr>
              </thead>
              <tbody id="amortizationTableBody">
                <!-- Table content will be generated by JavaScript -->
              </tbody>
            </table>
          </div>
          
          <button type="button" id="downloadBtn" class="btn-download" data-i18n="sim_download">
            <i class="fas fa-file-pdf"></i> Télécharger le récapitulatif en PDF
          </button>
        </div>
        
        <div class="no-result" id="noResult">
          <i class="fas fa-calculator"></i>
          <p data-i18n="sim_no_result">Veuillez remplir les champs pour obtenir une simulation.</p>
        </div>
      </div>
    </div>
  </section>

  <!-- PDF Preview Modal -->
  <div id="pdfModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title" data-i18n="pdf_preview_title">Aperçu du PDF</h2>
        <button class="modal-close" id="closeModal">&times;</button>
      </div>
      <div id="pdfPreview" class="pdf-preview">
        <div class="pdf-header">
          <div class="pdf-logo">
            <div class="pdf-logo-circle">MSG</div>
            <div class="pdf-logo-text">Magdeleine Solutions</div>
          </div>
          <h1 class="pdf-title" data-i18n="sim_title">Simulation de prêt</h1>
          <p class="pdf-subtitle" data-i18n="pdf_subtitle">Récapitulatif détaillé de votre simulation</p>
          <p class="pdf-date" id="pdfDate">Date: 19/05/2025</p>
        </div>
        
        <div class="pdf-section">
          <h2 class="pdf-section-title" data-i18n="pdf_loan_details">Détails du prêt</h2>
          <div class="pdf-loan-details">
            <div class="pdf-detail-item">
              <div class="pdf-detail-label" data-i18n="sim_amount_borrowed">Montant emprunté</div>
              <div class="pdf-detail-value" id="pdfLoanAmount">100 000,00 €</div>
            </div>
            <div class="pdf-detail-item">
              <div class="pdf-detail-label" data-i18n="sim_duration">Durée du prêt</div>
              <div class="pdf-detail-value" id="pdfLoanDuration">120 mois (10 ans)</div>
            </div>
            <div class="pdf-detail-item">
              <div class="pdf-detail-label" data-i18n="sim_rate">Taux d'intérêt</div>
              <div class="pdf-detail-value" id="pdfInterestRate">3,0%</div>
            </div>
          </div>
          
          <div class="pdf-monthly-payment">
            <div class="pdf-monthly-label" data-i18n="sim_monthly">Mensualité</div>
            <div class="pdf-monthly-value" id="pdfMonthlyPayment">965,61 €</div>
          </div>
          
          <div class="pdf-loan-details">
            <div class="pdf-detail-item">
              <div class="pdf-detail-label" data-i18n="sim_total_interest">Coût total des intérêts</div>
              <div class="pdf-detail-value" id="pdfTotalInterest">15 873,59 €</div>
            </div>
            <div class="pdf-detail-item">
              <div class="pdf-detail-label" data-i18n="sim_total_cost">Coût total du crédit</div>
              <div class="pdf-detail-value" id="pdfTotalCost">115 873,59 €</div>
            </div>
            <div class="pdf-detail-item">
              <div class="pdf-detail-label" data-i18n="sim_type">Type de prêt</div>
              <div class="pdf-detail-value" id="pdfLoanType">Prêt personnel</div>
            </div>
          </div>
        </div>
        
        <div class="pdf-section">
          <h2 class="pdf-section-title" data-i18n="pdf_amortization">Tableau d'amortissement</h2>
          <table class="pdf-table">
            <thead>
              <tr>
                <th data-i18n="sim_table_year">Année</th>
                <th data-i18n="sim_table_principal">Capital remboursé</th>
                <th data-i18n="sim_table_interest">Intérêts payés</th>
                <th data-i18n="sim_table_remaining">Capital restant</th>
              </tr>
            </thead>
            <tbody id="pdfAmortizationTable">
              <!-- Table content will be generated by JavaScript -->
            </tbody>
          </table>
        </div>
        
        <div class="pdf-footer">
          <p data-i18n="pdf_disclaimer_1">Cette simulation est fournie à titre indicatif et ne constitue pas une offre contractuelle.</p>
          <p data-i18n="pdf_disclaimer_2">Les montants réels peuvent varier en fonction de votre situation personnelle et des conditions du marché.</p>
          <p class="pdf-contact" data-i18n="pdf_contact">Pour plus d'informations, contactez-nous au +33 7 45 40 20 18 ou à contact@creditlyonnaislcl.fr</p>
        </div>
      </div>
      
      <div class="modal-actions">
        <button type="button" id="downloadPdfBtn" class="btn-download-pdf" data-i18n="pdf_download">
          <i class="fas fa-download"></i> Télécharger le PDF
        </button>
        <button type="button" id="closeModalBtn" class="btn-close-modal" data-i18n="pdf_close">Fermer</button>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <footer>
    <div class="container">
      <div class="footer-content">
        <div class="footer-column footer-about">
          <div class="logo-circle">MSG</div>
          <p>Magdeleine Solutions groups</p>
          <p data-i18n="footer_about">Services de prêts entre particuliers depuis 2009</p>
          <div class="footer-social">
            <a href="#" class="social-icon"><i class="fab fa-facebook-f"></i></a>
            <a href="#" class="social-icon"><i class="fab fa-twitter"></i></a>
            <a href="#" class="social-icon"><i class="fab fa-instagram"></i></a>
            <a href="#" class="social-icon"><i class="fab fa-linkedin-in"></i></a>
          </div>
        </div>
        <div class="footer-column footer-links">
          <h4 data-i18n="footer_quick_links">Liens rapides</h4>
          <ul>
            <li><a href="index.html" class="i18n-link"><i class="fas fa-chevron-right"></i> <span data-i18n="nav_home">Accueil</span></a></li>
            <li><a href="index.html#about" class="i18n-link"><i class="fas fa-chevron-right"></i> <span data-i18n="nav_about">À propos</span></a></li>
            <li><a href="index.html#services" class="i18n-link"><i class="fas fa-chevron-right"></i> <span data-i18n="nav_services">Services</span></a></li>
            <li><a href="index.html#testimonials" class="i18n-link"><i class="fas fa-chevron-right"></i> <span data-i18n="nav_testimonials">Témoignages</span></a></li>
            <li><a href="index.html#contact" class="i18n-link"><i class="fas fa-chevron-right"></i> <span data-i18n="footer_contact">Contact</span></a></li>
          </ul>
        </div>
        <div class="footer-column footer-links">
          <h4 data-i18n="footer_services">Nos services</h4>
          <ul>
            <li><a href="index.html#services" class="i18n-link"><i class="fas fa-chevron-right"></i> <span data-i18n="service1_title">Prêt personnel</span></a></li>
            <li><a href="index.html#services" class="i18n-link"><i class="fas fa-chevron-right"></i> <span data-i18n="service2_title">Prêt immobilier</span></a></li>
            <li><a href="index.html#services" class="i18n-link"><i class="fas fa-chevron-right"></i> <span data-i18n="service3_title">Prêt professionnel</span></a></li>
            <li><a href="index.html#services" class="i18n-link"><i class="fas fa-chevron-right"></i> <span data-i18n="service4_title">Rachat de crédit</span></a></li>
            <li><a href="biographie.html" class="i18n-link"><i class="fas fa-chevron-right"></i> <span data-i18n="nav_biography">Biographie</span></a></li>
          </ul>
        </div>
        <div class="footer-column footer-newsletter">
          <h4 data-i18n="footer_newsletter">Newsletter</h4>
          <p data-i18n="footer_newsletter_desc">Inscrivez-vous à notre newsletter pour recevoir nos actualités et conseils financiers.</p>
          <form class="newsletter-form">
            <input type="email" data-i18n-placeholder="newsletter_placeholder" placeholder="Votre email" class="newsletter-input" required>
            <button type="submit" class="newsletter-button"><i class="fas fa-paper-plane"></i></button>
          </form>
          <div class="footer-contact">
            <p><i class="fas fa-phone-alt"></i> <a href="tel: +33745402018" style="text-decoration: none; color: inherit;"> 07 45 40 20 18</a></p>
            <p><i class="fas fa-envelope"></i> <a href="mailto:groupe@sergemagdeleinesolutions.com" style="text-decoration: none; color: inherit;">groupe@sergemagdeleinesolutions.com</a></p>
          </div>
        </div>
      </div>
      <div class="footer-bottom">
        <p>&copy; 2025 Magdeleine Solutions groups. <span data-i18n="footer_rights">Tous droits réservés.</span> | <a href="#" data-i18n="footer_privacy">Politique de confidentialité</a> | <a href="#" data-i18n="footer_terms">Conditions d'utilisation</a></p>
      </div>
    </div>
  </footer>

  <!-- Back to Top Button -->
  <div class="back-to-top" id="back-to-top">
    <i class="fas fa-arrow-up"></i>
  </div>

  <!-- Scripts -->
  <script src="https://unpkg.com/aos@next/dist/aos.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.3.2/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>
  <script src="translations.js"></script>
  <script src="language.js"></script>
  <script>
    // Initialize AOS
    AOS.init({
      duration: 800,
      easing: 'ease',
      once: true,
      offset: 100
    });

    // Mobile Menu Toggle
    const menuToggle = document.getElementById('menu-toggle');
    const navMenu = document.getElementById('nav-menu');

    menuToggle.addEventListener('click', function() {
      navMenu.classList.toggle('active');
      if (navMenu.classList.contains('active')) {
        menuToggle.innerHTML = '<i class="fas fa-times"></i>';
      } else {
        menuToggle.innerHTML = '<i class="fas fa-bars"></i>';
      }
    });

    // Back to Top Button
    const backToTopButton = document.getElementById('back-to-top');

    window.addEventListener('scroll', () => {
      if (window.scrollY > 300) {
        backToTopButton.classList.add('active');
      } else {
        backToTopButton.classList.remove('active');
      }
    });

    backToTopButton.addEventListener('click', () => {
      window.scrollTo({
        top: 0,
        behavior: 'smooth'
      });
    });

    // Loan Simulation Logic
    document.addEventListener('DOMContentLoaded', function() {
      // Elements
      const loanAmountRange = document.getElementById('loanAmountRange');
      const loanAmountInput = document.getElementById('loanAmount');
      const loanAmountValue = document.getElementById('loanAmountValue');
      
      const loanDurationRange = document.getElementById('loanDurationRange');
      const loanDurationSelect = document.getElementById('loanDuration');
      const loanDurationValue = document.getElementById('loanDurationValue');
      
      const interestRateRange = document.getElementById('interestRateRange');
      const interestRateInput = document.getElementById('interestRate');
      const interestRateValue = document.getElementById('interestRateValue');
      
      const loanTypeSelect = document.getElementById('loanType');
      const calculateBtn = document.getElementById('calculateBtn');
      
      const noResult = document.getElementById('noResult');
      const simulationResult = document.querySelector('.simulation-result');
      
      const monthlyPaymentValue = document.getElementById('monthlyPaymentValue');
      const loanAmountResult = document.getElementById('loanAmountResult');
      const loanDurationResult = document.getElementById('loanDurationResult');
      const interestRateResult = document.getElementById('interestRateResult');
      const totalInterestResult = document.getElementById('totalInterestResult');
      const totalCostResult = document.getElementById('totalCostResult');
      
      const amortizationTableBody = document.getElementById('amortizationTableBody');
      
      const downloadBtn = document.getElementById('downloadBtn');
      const pdfModal = document.getElementById('pdfModal');
      const closeModal = document.getElementById('closeModal');
      const closeModalBtn = document.getElementById('closeModalBtn');
      const downloadPdfBtn = document.getElementById('downloadPdfBtn');
      
      // Format currency based on current language
      function formatCurrency(amount) {
        const lang = localStorage.getItem('preferredLanguage') || 'fr';
        let locale = 'fr-FR';
        
        // Set locale based on language
        switch(lang) {
          case 'en': locale = 'en-US'; break;
          case 'de': locale = 'de-DE'; break;
          case 'pl': locale = 'pl-PL'; break;
          case 'it': locale = 'it-IT'; break;
          case 'pt': locale = 'pt-PT'; break;
          default: locale = 'fr-FR';
        }
        
        return new Intl.NumberFormat(locale, { 
          style: 'currency', 
          currency: 'EUR',
          minimumFractionDigits: 2,
          maximumFractionDigits: 2 
        }).format(amount);
      }
      
      // Format percentage based on current language
      function formatPercentage(percentage) {
        const lang = localStorage.getItem('preferredLanguage') || 'fr';
        let locale = 'fr-FR';
        
        // Set locale based on language
        switch(lang) {
          case 'en': locale = 'en-US'; break;
          case 'de': locale = 'de-DE'; break;
          case 'pl': locale = 'pl-PL'; break;
          case 'it': locale = 'it-IT'; break;
          case 'pt': locale = 'pt-PT'; break;
          default: locale = 'fr-FR';
        }
        
        return new Intl.NumberFormat(locale, { 
          style: 'percent',
          minimumFractionDigits: 1,
          maximumFractionDigits: 1
        }).format(percentage / 100);
      }
      
      // Format duration based on current language
      function formatDuration(months) {
        const years = Math.floor(months / 12);
        const lang = localStorage.getItem('preferredLanguage') || 'fr';
        
        // Translated texts for "month" and "year(s)"
        const translations = {
          'fr': { month: 'mois', year: 'an', years: 'ans' },
          'en': { month: 'months', year: 'year', years: 'years' },
          'de': { month: 'Monate', year: 'Jahr', years: 'Jahre' },
          'pl': { month: 'miesięcy', year: 'rok', years: 'lat' },
          'it': { month: 'mesi', year: 'anno', years: 'anni' },
          'pt': { month: 'meses', year: 'ano', years: 'anos' }
        };
        
        const t = translations[lang] || translations['fr'];
        const yearText = years === 1 ? t.year : t.years;
        
        return `${months} ${t.month} (${years} ${yearText})`;
      }
      
      // Calculate monthly payment
      function calculateMonthlyPayment(principal, annualRate, months) {
        const monthlyRate = annualRate / 100 / 12;
        return principal * monthlyRate * Math.pow(1 + monthlyRate, months) / (Math.pow(1 + monthlyRate, months) - 1);
      }
      
      // Calculate amortization schedule
      function calculateAmortizationSchedule(principal, annualRate, months) {
        const monthlyRate = annualRate / 100 / 12;
        const monthlyPayment = calculateMonthlyPayment(principal, annualRate, months);
        
        let remainingPrincipal = principal;
        let totalInterest = 0;
        const schedule = [];
        
        // Calculate yearly totals
        for (let year = 1; year <= Math.ceil(months / 12); year++) {
          let yearlyPrincipal = 0;
          let yearlyInterest = 0;
          
          for (let month = 1; month <= 12; month++) {
            if ((year - 1) * 12 + month > months) break;
            
            const interestPayment = remainingPrincipal * monthlyRate;
            const principalPayment = monthlyPayment - interestPayment;
            
            yearlyPrincipal += principalPayment;
            yearlyInterest += interestPayment;
            remainingPrincipal -= principalPayment;
          }
          
          totalInterest += yearlyInterest;
          
          schedule.push({
            year,
            principalPaid: yearlyPrincipal,
            interestPaid: yearlyInterest,
            remainingPrincipal: remainingPrincipal > 0 ? remainingPrincipal : 0,
            totalPrincipalPaid: principal - remainingPrincipal,
            totalInterestPaid: totalInterest
          });
        }
        
        return {
          monthlyPayment,
          totalInterest,
          totalCost: principal + totalInterest,
          schedule
        };
      }
      
      // Update range value displays
      function updateRangeValues() {
        loanAmountValue.textContent = formatCurrency(loanAmountRange.value);
        loanDurationValue.textContent = formatDuration(loanDurationRange.value);
        interestRateValue.textContent = formatPercentage(interestRateRange.value);
      }
      
      // Sync range and input values
      function syncRangeAndInput() {
        // Loan Amount
        loanAmountRange.addEventListener('input', function() {
          loanAmountInput.value = this.value;
          loanAmountValue.textContent = formatCurrency(this.value);
        });
        
        loanAmountInput.addEventListener('input', function() {
          if (this.value < 2000) this.value = 2000;
          if (this.value > 1000000) this.value = 1000000;
          loanAmountRange.value = this.value;
          loanAmountValue.textContent = formatCurrency(this.value);
        });
        
        // Loan Duration
        loanDurationRange.addEventListener('input', function() {
          loanDurationSelect.value = this.value;
          loanDurationValue.textContent = formatDuration(this.value);
        });
        
        loanDurationSelect.addEventListener('change', function() {
          loanDurationRange.value = this.value;
          loanDurationValue.textContent = formatDuration(this.value);
        });
        
        // Interest Rate
        interestRateRange.addEventListener('input', function() {
          interestRateInput.value = this.value;
          interestRateValue.textContent = formatPercentage(this.value);
        });
        
        interestRateInput.addEventListener('input', function() {
          if (this.value < 1) this.value = 1;
          if (this.value > 10) this.value = 10;
          interestRateRange.value = this.value;
          interestRateValue.textContent = formatPercentage(this.value);
        });
      }
      
      // Calculate loan and update results
      function calculateLoan() {
        const principal = parseFloat(loanAmountInput.value);
        const months = parseInt(loanDurationSelect.value);
        const rate = parseFloat(interestRateInput.value);
        const loanType = loanTypeSelect.value;
        
        const result = calculateAmortizationSchedule(principal, rate, months);
        
        // Update result display
        monthlyPaymentValue.textContent = formatCurrency(result.monthlyPayment);
        loanAmountResult.textContent = formatCurrency(principal);
        loanDurationResult.textContent = formatDuration(months);
        interestRateResult.textContent = formatPercentage(rate);
        totalInterestResult.textContent = formatCurrency(result.totalInterest);
        totalCostResult.textContent = formatCurrency(result.totalCost);
        
        // Generate amortization table
        amortizationTableBody.innerHTML = '';
        result.schedule.forEach(row => {
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td>${row.year}</td>
            <td>${formatCurrency(row.principalPaid)}</td>
            <td>${formatCurrency(row.interestPaid)}</td>
            <td>${formatCurrency(row.remainingPrincipal)}</td>
          `;
          amortizationTableBody.appendChild(tr);
        });
        
        // Show results
        noResult.style.display = 'none';
        simulationResult.style.display = 'block';
        
        // Update PDF preview data
        document.getElementById('pdfLoanAmount').textContent = formatCurrency(principal);
        document.getElementById('pdfLoanDuration').textContent = formatDuration(months);
        document.getElementById('pdfInterestRate').textContent = formatPercentage(rate);
        document.getElementById('pdfMonthlyPayment').textContent = formatCurrency(result.monthlyPayment);
        document.getElementById('pdfTotalInterest').textContent = formatCurrency(result.totalInterest);
        document.getElementById('pdfTotalCost').textContent = formatCurrency(result.totalCost);
        
        // Get loan type text
        const loanTypeText = getLoanTypeText(loanType);
        document.getElementById('pdfLoanType').textContent = loanTypeText;
        
        // Update PDF date
        const today = new Date();
        const dateOptions = { year: 'numeric', month: '2-digit', day: '2-digit' };
        const lang = localStorage.getItem('preferredLanguage') || 'fr';
        document.getElementById('pdfDate').textContent = `Date: ${today.toLocaleDateString(getLocale(lang), dateOptions)}`;
        
        // Generate PDF amortization table
        const pdfAmortizationTable = document.getElementById('pdfAmortizationTable');
        pdfAmortizationTable.innerHTML = '';
        result.schedule.forEach(row => {
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td>${row.year}</td>
            <td>${formatCurrency(row.principalPaid)}</td>
            <td>${formatCurrency(row.interestPaid)}</td>
            <td>${formatCurrency(row.remainingPrincipal)}</td>
          `;
          pdfAmortizationTable.appendChild(tr);
        });
      }
      
      // Get loan type text based on current language
      function getLoanTypeText(loanType) {
        const lang = localStorage.getItem('preferredLanguage') || 'fr';
        
        if (!window.translations || !window.translations[lang]) {
          // Fallback values if translations are not available
          const fallbackTexts = {
            'personal': 'Prêt personnel',
            'mortgage': 'Prêt immobilier',
            'business': 'Prêt professionnel',
            'debt_consolidation': 'Rachat de crédit'
          };
          return fallbackTexts[loanType] || fallbackTexts['personal'];
        }
        
        const translationKeys = {
          'personal': 'loan_type_personal',
          'mortgage': 'loan_type_mortgage',
          'business': 'loan_type_business',
          'debt_consolidation': 'loan_type_debt_consolidation'
        };
        
        const key = translationKeys[loanType] || translationKeys['personal'];
        return window.translations[lang][key] || window.translations['fr'][key];
      }
      
      // Get locale string based on language
      function getLocale(lang) {
        switch(lang) {
          case 'en': return 'en-US';
          case 'de': return 'de-DE';
          case 'pl': return 'pl-PL';
          case 'it': return 'it-IT';
          case 'pt': return 'pt-PT';
          default: return 'fr-FR';
        }
      }
      
      // Modal functions
      function openModal() {
        pdfModal.classList.add('active');
        document.body.style.overflow = 'hidden';
      }
      
      function closeModalFunc() {
        pdfModal.classList.remove('active');
        document.body.style.overflow = '';
      }
      
      // Generate and download PDF
      function generatePDF() {
        const { jsPDF } = window.jspdf;
        const pdf = new jsPDF('p', 'mm', 'a4');
        const pdfPreview = document.getElementById('pdfPreview');
        
        html2canvas(pdfPreview).then(canvas => {
          const imgData = canvas.toDataURL('image/png');
          const imgWidth = 210; // A4 width in mm
          const pageHeight = 297; // A4 height in mm
          const imgHeight = canvas.height * imgWidth / canvas.width;
          let heightLeft = imgHeight;
          let position = 0;
          
          pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
          heightLeft -= pageHeight;
          
          while (heightLeft >= 0) {
            position = heightLeft - imgHeight;
            pdf.addPage();
            pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
            heightLeft -= pageHeight;
          }
          
          pdf.save('simulation-pret-magdeleine-solutions.pdf');
        });
      }
      
      // Update loan type options based on current language
      function updateLoanTypeOptions(lang) {
        if (!window.translations || !window.translations[lang]) return;
        
        const options = loanTypeSelect.querySelectorAll('option');
        options.forEach(option => {
          const key = option.getAttribute('data-i18n');
          if (key && window.translations[lang][key]) {
            option.textContent = window.translations[lang][key];
          }
        });
      }
      
      // Event listeners
      calculateBtn.addEventListener('click', calculateLoan);
      
      downloadBtn.addEventListener('click', openModal);
      
      closeModal.addEventListener('click', closeModalFunc);
      closeModalBtn.addEventListener('click', closeModalFunc);
      
      downloadPdfBtn.addEventListener('click', generatePDF);
      
      // Close modal when clicking outside
      window.addEventListener('click', function(event) {
        if (event.target === pdfModal) {
          closeModalFunc();
        }
      });
      
      // Listen for language changes
      document.addEventListener('languageChanged', function(event) {
        const currentLang = event.detail.language;
        
        // Update formatted values
        updateRangeValues();
        
        // Update loan type options
        updateLoanTypeOptions(currentLang);
        
        // If results are already displayed, recalculate to update labels
        if (simulationResult.style.display === 'block') {
          calculateLoan();
        }
      });
      
      // Initialize
      updateRangeValues();
      syncRangeAndInput();
    });
  </script>
  
  <!-- Script d'initialisation pour la gestion des langues -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Vérifier si un paramètre de langue est présent dans l'URL
      const urlParams = new URLSearchParams(window.location.search);
      const langParam = urlParams.get('lang');
      
      // Si un paramètre de langue est présent, le stocker dans localStorage
      if (langParam) {
        localStorage.setItem('preferredLanguage', langParam);
      }
      
      // Initialiser la gestion des langues
      if (typeof initializeLanguage === 'function') {
        initializeLanguage();
      } else {
        console.error("La fonction initializeLanguage n'est pas définie. Vérifiez que language.js est correctement chargé.");
        
        // Fallback: mettre à jour le sélecteur de langue avec la valeur stockée
        const savedLang = localStorage.getItem('preferredLanguage') || 'fr';
        const languageSelector = document.getElementById('language-selector');
        if (languageSelector) {
          languageSelector.value = savedLang;
        }
      }
      
      // Mettre à jour les liens pour maintenir la langue
      updateLinks();
    });
    
    // Fonction pour mettre à jour les liens avec la langue actuelle
    function updateLinks() {
      const currentLang = localStorage.getItem('preferredLanguage') || 'fr';
      const links = document.querySelectorAll('.i18n-link');
      
      links.forEach(link => {
        const href = link.getAttribute('href');
        if (href && !href.includes('#') && !href.includes('?lang=')) {
          // Ajouter le paramètre de langue seulement si le lien ne contient pas déjà un paramètre de langue
          link.setAttribute('href', `${href}${href.includes('?') ? '&' : '?'}lang=${currentLang}`);
        }
      });
    }
  </script>
</body>
</body>
</html>
